import streamlit as st
from nebula3.gclient.net import ConnectionPool
import pandas as pd

st.set_page_config(
    page_title="Nebula Graph Explorer",
    layout="wide"
)

# ä¾§è¾¹æ é…ç½®
with st.sidebar:
    st.title("ğŸ” Nebula Graph é…ç½®")
    space = st.selectbox("é€‰æ‹©å›¾ç©ºé—´", ["social_graph", "movie_graph"])
    query_type = st.radio("æŸ¥è¯¢ç±»å‹", ["èŠ‚ç‚¹æŸ¥è¯¢", "è·¯å¾„æŸ¥è¯¢", "æ¨¡å¼åŒ¹é…"])
    
    if query_type == "èŠ‚ç‚¹æŸ¥è¯¢":
        vertex_id = st.text_input("èŠ‚ç‚¹ID")
        depth = st.slider("éå†æ·±åº¦", 1, 5, 2)
        
    query = st.text_area("nGQL æŸ¥è¯¢", height=100)

# ä¸»ç•Œé¢
if st.button("æ‰§è¡ŒæŸ¥è¯¢"):
    with st.spinner("æ­£åœ¨æŸ¥è¯¢..."):
        # æ‰§è¡ŒNebulaæŸ¥è¯¢
        result = execute_nebula_query(query)
        
        # æ˜¾ç¤ºç»“æœ
        col1, col2 = st.columns([2, 1])
        
        with col1:
            st.subheader("å¯è§†åŒ–ç»“æœ")
            visualize_graph_result(result)
            
        with col2:
            st.subheader("æ•°æ®è¯¦æƒ…")
            df = result_to_dataframe(result)
            st.dataframe(df, use_container_width=True)
            
        # ç»Ÿè®¡ä¿¡æ¯
        with st.expander("ç»Ÿè®¡ä¿¡æ¯"):
            show_statistics(result)
